# Webdriver.io tests

Тестовый проект на Webdriver.io и Codecept.js со множеством вспомогательных функций

## Установка

Установить зависимости и локальный сервер selenium-standalone 
```
npm run deploy
```

Установить зависимости без сервера selenium-standalone 
```
npm install
```

Запустить локальный сервер Allure
```
npm run report
```

Запустить selenium-standalone
```
selenium-standalone start
```

## Запуск тестов

Запуск тестов производит файл helpers/run.js
```
node helpers/run.js run --config ./my_config.json
```

Пример
```
node helpers/run.js run --config ./example_demo_publisher3.json
```
### Опции командной строки
```-c, --config [file] ```- обязательная опция, задает конфиг для тестов. Принимает строку с путем к конфигу.

```-o, --override [value]``` - необязательная опция. Позволяет динамически перезаписывать параметры конфига, принимает json в формате конфига codecept.js

```-a, --async``` - необязательная опция. Запускает сценарии одновременно.

```-p, --params <items>```  - необязательная опция. Передает аргументы в командную строку codecept.js. 
Принимает список, разделенный запятой.
для подробного вывода codecept.js в консоль можно указать параметры ```'--debug,--steps'``` 

```-v, --verbose``` - необязательная опция. Подробный вывод в целях отладки раннера, не codecept.js.

### Опции конфигурационного файла

Основные параметры
```
{
  "output": "./output", //Путь для папки со скриншотами. 
  При задании этой опции сюда будут помещаться скриншоты ошибочных тестов, помимо записи в allure
  "helpers": {
    "WebDriverIO": {
      "url": "https://demo-merchant.xsolla.com", 
      //Домен по умолчанию. 
      //Команды, не содержащие домена будут открывать страницы с этим доменом
      "browser": "chrome", //Браузер для выполнения тестов
      "smartWait": 30001, //Время ожидания элемента по умолчанию, перед выполнением команды 
      "waitForTimeout": 30001, //Время ожидания элемента по умолчанию, для команды ожидания элемента
      "host": "localhost", //Домен сервера вебдрайвера. 
      //Можно задать так же наш адрес selenium grid: seleniumgrid.srv.local
      "port": "4444", //Порт сервера вебдрайвера
      "path": "/wd/hub", //Страница инициализации сервера вебдрайвера
      "desiredCapabilities": { //Дополнительные опции для браузеров
        "chromeOptions": { //опции для хрома
          "args": [ "--headless", "--disable-gpu", "--window-size=1920,1080" ] 
          //Опции --headless, --disable-gpu" для отключения вьюпорта браузера
          //Опция "--window-size=1920,1080"  задает разрешение окна браузера
        }
      }
    }
  },
  "include": { // позволяет подключать к тестовым сценариям собственные команды
    "I": "./steps/steps_file.js", //некоторые команды-хэлперы
    "service": "./steps/vars.js" //сервисные команды. Содержит команду логина, 
    //читающую сценарий логина из параметра loginScript конфига.
    //При задании опции асинхронного запуска, этот хэлпер позволяет выполнять сценарий логина 
    //только один раз, перед запуском асинхронных тестов.
    //При выполнении сценариев синхронно, этот хэлпер выполняет сценарий логина перед каждым тестом.
    //Таким образом реализуется асинхронный запуск тестов, без необходимости изменения самих файлов тестов.
  },
  "bootstrap": "./helpers/eventsHandler.js", // Этот файл выполнится перед запуском тестов
  "teardown": null, // Этот файл выполнится после запуска тестов
  "hooks": [],  //Хуки. Эта опция похожа на bootstrap и teardown, 
                //но позволяет регистрировать множество файлов для подключения к диспетчеру ивентов codecept.js
  "tests": "./tests/demo_publisher/demo_publisher_*", //Сценарии тестов. 
  //Паттерн для поиска тестовых файлов пишется в соответствии с форматом пакета glob 
  //https://www.npmjs.com/package/glob
  "timeout": 36000, //После этого времени кодцепт остановит выполнение сценария с ошибкой. 
                    //Не позволяет тестам зависать навсегда 
  "name": "publisher 3", //Имя тестового наборта
  "loginScript": "./tests/demo_publisher/login_prod.js" //сценарий логина. 
  //Необязательный параметр. Позволяет использовать один сценарий логина для синхронных и асинхронных тестов.
  "threadsLimit": 2 //Лимит асинхронных тестов в единицу времени
}
```

Остальные параметры описаны здесь https://codecept.io/configuration/
Пример конфигурационного файла можно посмотреть в файле example_demo_publisher3.json

### Хэлперы из папки steps

**vars.js**

сервисные функции. Содержит функцию логина. 
При подключении будет доступна в колбеке функции Scenario. 
Для работы функции логина, необходимо задать сценарий логина в параметре loginScript конфига
Пример использования

```
Scenario('demo publisher payrank',  async (I, service) => {
    await service.login(I);
    await I.amOnPage('/1/payrank');
    await I.waitForElement('//*[@data-original-title="Fix payment method"]');
});
```

При выполнении с асинхронным флагом сценарий loginScript будет выполнен перед запуском тестов автоматически
Можно реализовать собственный сценарий логина, вместо использования опции loginScript.

**steps_file.js**

Содержит некоторые кастомные шаги для тестов. 

* ```I.seeText(text)``` Ожидает элемент, текст которого равняется заданному тексту
* ```I.seeContainsText(text)``` Ожидает элемент, текст которого содержит заданный тескст
* ```I.clickOn(selector)``` Выполняет клик по элементу с предварительным ожиданием элемента. Принимает xpath и css селекторы. Определет тип селектора автоматически

Пример использования
```
Scenario('demo publisher payrank',  async (I, service) => {
    await service.login(I);
    await I.amOnPage('/1/payrank');
    await I.seeText('2.5%')
    await I.seeContainsText('2.5')
    await I.clickOn('//*[contains(@class, "ps-edit")]');
});
```

Стандартные методы для работы с браузером можно посмотреть здесь https://codecept.io/helpers/WebDriverIO/